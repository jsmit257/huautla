---

eventtypes:

ingredient:
  select-all: select uuid, name from ingredients order by name
  select: select name from ingredients where uuid = ?
  insert: insert into ingredients(uuid, name) values(?, ?)
  update: update ingredients set name = ? where uuid = ?
  delete: delete from ingredients where uuid = ?

stage:
  select-all: select uuid, name from stages order by name
  select: select name from stages where uuid = ?
  insert: insert into stages(uuid, name) values(?, ?)
  update: update stages set name = ? where uuid = ?
  delete: delete from stages where uuid = ?

strain:
  select-all: >
    select s.name, 
           v.uuid as vendor_uuid,
           v.name as vendor_name
      from strains s
      join vendors v
        on s.vendor_uuid = v.uuid
     order
        by s.name
  select: >
    select s.name, 
           v.uuid as vendor_uuid,
           v.name as vendor_name
      from strains s
      join vendors v
        on s.vendor_uuid = v.uuid
     where s.uuid = ?
  insert: >
    insert 
      into strains(uuid, name, vendor_uuid)
    select ?, ?, v.uuid 
      from vendors v
     where vendor_uuid = ?
  update: update strains set name = ? where uuid = ?
  delete: delete from strains where uuid = ?
  all-attributes: >
    select uuid, name, value
      from strain_attributes sa
     where strain_uuid = ?

substrate:
  select-all: >
    select s.name, 
           v.uuid as vendor_uuid,
           v.name as vendor_name
      from substrates s
      join vendors v
        on s.vendor_uuid = v.uuid
     order
        by s.name
  select: >
    select s.name, 
           v.uuid as vendor_uuid,
           v.name as vendor_name
      from substrates s
      join vendors v
        on s.vendor_uuid = v.uuid
     where s.uuid = ?
  insert: >
    insert 
      into substrates(uuid, name, vendor_uuid)
    select ?, ?, v.uuid 
      from vendors v
     where vendor_uuid = ?
  update: update substrates set name = ? where uuid = ?
  delete: delete from substrates where uuid = ?

substrate-ingredient:
  all-ingredients: >
    select i.uuid,
           i.name 
      from ingredients i
      join substrate_ingredients si
        on i.uuid = si.ingredient_uuid
     where si.substrate_id = ?
  add-ingredient: >
      insert 
      into substrate_ingredients (uuid, substrate_uuid, ingredient_uuid) 
    select ?, s.uuid, i.uuid 
      from substrates s,
           ingredient i 
     where s.uuid = ? 
       and i.uuid = ?
    # insert 
    #   into substrate_ingredients (uuid, substrate_uuid, ingredient_uuid) 
    # select ?, s.uuid, i.uuid 
    #   from substrates s 
    #   join substrate_ingredients si 
    #     on s.uuid = si.substrate_id 
    #   join ingredient i 
    #     on si.ingredient_id = i.uuid 
    #  where s.uuid = ? 
    #    and i.uuid = ?
  change-ingredient: >
    update substrate_ingredients set ingredient_uuid = ? where uuid = ?
  remove-ingredient: >
    delete from substrate_ingredients where uuid = ?

vendor:
  select-all: select uuid, name from vendors order by name
  select: select name from vendors where uuid = ?
  insert: insert into vendors(uuid, name) values(?, ?)
  update: update vendors set name = ? where uuid = ?
  delete: delete from vendors where uuid = ?
